<!DOCTYPE html>
<html>
<head>
    <title>Выставление счетов</title>
    <meta charset="utf-8">
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../assets/css/bootstrap-reboot.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<div class="container-fluid">
    <div class="text-center">
        <h1>Выставление счетов</h1>
    </div>
</div>

<div class="container-fluid">
    <div class="row mt-3 mb-xl-5">
        <div class="col-3 m-auto">
            <div class="card mt-3" id="InputNewInvoice">
                <h5 class="card-header">Выставить счета по списку</h5>
                <div class="card-body">
                    <form class="form">
                        <div class="share-form">
                            <div class="input-group">
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="InputNewInvoiceChooseFile" name="uploaded_file" lang="ru" aria-describedby="InputNewInvoiceAdd" required>
                                    <label class="custom-file-label" for="InputNewInvoiceChooseFile" data-browse="Обзор">Выберите файл</label>
                                </div>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="InputNewInvoiceAdd_Button">Загрузить</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer" id="InputCalendar" >
                    <div class="d-flex justify-content-center">
                    	<div>
                    		<input type="week" id="week" name="week" placeholder="Укажите номер недели и год" required>
                    	</div>
                    </div>
                </div>
                <div class="card-footer" id="InputNewInvoiceFooter" >
                    <div class="progress" style="height: 20px;">
                            <div class="progress-bar progress-bar-striped c active" id="general-progress" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
                                <i class="fa fa-spinner fa-spin fa-fw"></i><span id="progress-value">50%</span>
                            </div>
                        </div>
                    <div class="d-flex justify-content-center">                        
                        <div class="spinner-border text-primary" role="status" id="statusSpinnerInputNewInvoice" hidden="hidden">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                    	<p class="text-success font-weight-bold" id="successStatementInputNewInvoice" >success</p>
                    	<p class="text-danger font-weight-bold" id="warningStatementInputNewInvoice" >warning</p>
                </div>
			</div>
		</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-latest.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        let flag = false;
        // Нажатие кнопки выбор файла
        $('#InputNewInvoiceChooseFile').on('change',function(){
            // получаем имя файла
            var fileName = $(this).val();
            // измените значение "fake path" (в Chrome) на пустую строку
            fileName = fileName.replace("C:\\fakepath\\", "");
            // заменяем надпись "Выберите файл" в label
            $(this).next('.custom-file-label').html(fileName);

            if( this.value ){
                flag = true;
                console.log( "Выбрали файл!" ); 
            } else { // Если после выбранного тыкнули еще раз, но дальше cancel
                flag = false;
                console.log( "Файл не выбран" ); 
            }

        })
        // Step 1 reading a file
        $('#InputNewInvoiceAdd_Button').click(function () {
            if (!flag) {
                // alert('Выбирете файл');
            }
        	
            let text = document.getElementById("week");
			let val = text.value;
			
            if (val == '') {
                // alert('Выбирете период');
            }

            let percent = 33;
            $( "#general-progress" ).css('width', percent + '%');
            $( "#progress-value" ).html(percent + '%');
            $( ".fa-spinner" ).prop('hidden', false);
            //$( ".fa-spinner" ).removeClass('hidden');

            //////////////////////////////////////////////////////
            let files = document.querySelector('#InputNewPaymentsChooseFile').files;

            console.log(files);

            let data = null;
            data = new FormData();
            $.each(files, function( key, value ){
                data.append( key, value );
            });
            data.append( 'my_file_upload', 1 );

            console.log(data.getAll('0'))
            $.ajax({
                url         : 'check.php',
                type        : 'POST', // важно!
                data        : data,
                cache       : false,
                // dataType    : 'json',
                // отключаем обработку передаваемых данных, пусть передаются как есть
                processData : false,
                // отключаем установку заголовка типа запроса. Так jQuery скажет серверу что это строковой запрос
                contentType : false,

                beforeSend : function(){

                },

                complete : function(){

                },

                success : function(respond, status, jqXHR ){
                    console.log(respond);
                },

                error: function( jqXHR, status, errorThrown ){

                }
            
        })

        // Step 2 search for the company ID by internal number


        // Step 3 recording the mass and period in the company


        // Step 4 search for a deal by company ID 


        // Step 5 Choosing a direction Оплата по Кг


    })    
</script>       

</body>
</html>